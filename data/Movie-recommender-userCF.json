{"paragraphs":[{"text":"%spark\n// 获取数据\nval data = spark.read\n  .option(\"header\", \"true\") //将第一行当作表头\n  .option(\"inferSchema\", \"true\") //推断数据类型\n  .csv(\"hdfs://nameservice1/test/data/ratings.csv\")","user":"anonymous","dateUpdated":"2023-03-17T15:08:18+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"data: org.apache.spark.sql.DataFrame = [user_id: int, movie_id: int ... 2 more fields]\n"}]},"apps":[],"jobName":"paragraph_1679036716538_-1702799049","id":"20230317-150516_1686226190","dateCreated":"2023-03-17T15:05:16+0800","dateStarted":"2023-03-17T15:08:18+0800","dateFinished":"2023-03-17T15:09:33+0800","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5362"},{"text":"%spark\n// 打印数据集的类型信息\ndata.printSchema()\n// 打印数据集的统计信息\ndata.describe().show()","user":"anonymous","dateUpdated":"2023-03-17T15:13:36+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- user_id: integer (nullable = true)\n |-- movie_id: integer (nullable = true)\n |-- rating: double (nullable = true)\n |-- timestamp: integer (nullable = true)\n\n+-------+------------------+----------------+------------------+--------------------+\n|summary|           user_id|        movie_id|            rating|           timestamp|\n+-------+------------------+----------------+------------------+--------------------+\n|  count|            100836|          100836|            100836|              100836|\n|   mean|326.12756356856676|19435.2957177992| 3.501556983616962|1.2059460873684695E9|\n| stddev| 182.6184914635004|35530.9871987003|1.0425292390606342|2.1626103599513078E8|\n|    min|                 1|               1|               0.5|           828124615|\n|    max|               610|          193609|               5.0|          1537799250|\n+-------+------------------+----------------+------------------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1679036770578_-555945898","id":"20230317-150610_1149009044","dateCreated":"2023-03-17T15:06:10+0800","dateStarted":"2023-03-17T15:12:46+0800","dateFinished":"2023-03-17T15:12:49+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5363"},{"text":"%spark\ndata.createOrReplaceTempView(\"udata\")","user":"anonymous","dateUpdated":"2023-03-17T15:14:42+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1679037019221_-652785138","id":"20230317-151019_2035702747","dateCreated":"2023-03-17T15:10:19+0800","dateStarted":"2023-03-17T15:14:42+0800","dateFinished":"2023-03-17T15:14:44+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5364"},{"text":"%spark\nval userItemDf = spark.sql(\"select * from udata\")\nval userItemDf2 = spark.sql(\"select user_id as user_id2,movie_id as movie_id2,rating as rating2 from udata\")\nuserItemDf.show(10)","user":"anonymous","dateUpdated":"2023-03-17T15:19:12+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------+------+---------+\n|user_id|movie_id|rating|timestamp|\n+-------+--------+------+---------+\n|      1|       1|   4.0|964982703|\n|      1|       3|   4.0|964981247|\n|      1|       6|   4.0|964982224|\n|      1|      47|   5.0|964983815|\n|      1|      50|   5.0|964982931|\n|      1|      70|   3.0|964982400|\n|      1|     101|   5.0|964980868|\n|      1|     110|   4.0|964982176|\n|      1|     151|   5.0|964984041|\n|      1|     157|   5.0|964984100|\n+-------+--------+------+---------+\nonly showing top 10 rows\n\nuserItemDf: org.apache.spark.sql.DataFrame = [user_id: int, movie_id: int ... 2 more fields]\nuserItemDf2: org.apache.spark.sql.DataFrame = [user_id2: int, movie_id2: int ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1679037282854_-1075773816","id":"20230317-151442_459064462","dateCreated":"2023-03-17T15:14:42+0800","dateStarted":"2023-03-17T15:18:36+0800","dateFinished":"2023-03-17T15:18:37+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5365"},{"text":"%spark\nval joinDf = userItemDf.join(userItemDf2, userItemDf(\"movie_id\") === userItemDf2(\"movie_id2\")).filter(\"user_id < user_id2\")\njoinDf.show(10)","user":"anonymous","dateUpdated":"2023-03-17T15:20:01+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------+------+---------+--------+---------+-------+\n|user_id|movie_id|rating|timestamp|user_id2|movie_id2|rating2|\n+-------+--------+------+---------+--------+---------+-------+\n|      1|       1|   4.0|964982703|     610|        1|    5.0|\n|      1|       1|   4.0|964982703|     609|        1|    3.0|\n|      1|       1|   4.0|964982703|     608|        1|    2.5|\n|      1|       1|   4.0|964982703|     607|        1|    4.0|\n|      1|       1|   4.0|964982703|     606|        1|    2.5|\n|      1|       1|   4.0|964982703|     605|        1|    4.0|\n|      1|       1|   4.0|964982703|     604|        1|    3.0|\n|      1|       1|   4.0|964982703|     603|        1|    4.0|\n|      1|       1|   4.0|964982703|     601|        1|    4.0|\n|      1|       1|   4.0|964982703|     600|        1|    2.5|\n+-------+--------+------+---------+--------+---------+-------+\nonly showing top 10 rows\n\njoinDf: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [user_id: int, movie_id: int ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1679037463382_-1761912702","id":"20230317-151743_1012369413","dateCreated":"2023-03-17T15:17:43+0800","dateStarted":"2023-03-17T15:20:01+0800","dateFinished":"2023-03-17T15:20:18+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5366"},{"text":"%spark\nimport breeze.numerics.{pow, sqrt}\nimport spark.implicits._\n//user_id，rating\nval userSumDf = userItemDf.rdd.map(x => (x(0).toString, x(2).toString))\n  .groupByKey()\n  // 求每个用户的所有rating的平方和开方\n  .mapValues(x => sqrt(x.toArray.map(line => pow(line.toDouble, 2)).sum))\n  .toDF(\"user_id_sum\", \"rating_sqrt_sum\")\nuserSumDf.show(10)","user":"anonymous","dateUpdated":"2023-03-17T15:57:01+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------------------+\n|user_id_sum|   rating_sqrt_sum|\n+-----------+------------------+\n|        273|30.528675044947494|\n|        188|30.903074280724887|\n|        253|30.162062263711345|\n|        281|15.272524349301264|\n|        528|31.555506650979318|\n|        391| 76.61592523751182|\n|        282| 63.00793600809346|\n|         82| 52.23265262266507|\n|        232| 98.01020355044673|\n|        346| 47.94788837894741|\n+-----------+------------------+\nonly showing top 10 rows\n\nimport breeze.numerics.{pow, sqrt}\nimport spark.implicits._\nuserSumDf: org.apache.spark.sql.DataFrame = [user_id_sum: string, rating_sqrt_sum: double]\n"}]},"apps":[],"jobName":"paragraph_1679037587172_1744805565","id":"20230317-151947_1428174127","dateCreated":"2023-03-17T15:19:47+0800","dateStarted":"2023-03-17T15:57:01+0800","dateFinished":"2023-03-17T15:57:19+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5367"},{"text":"%spark\n//定义udf  两列进行相乘\nval productUdf = udf((s1: Int, s2: Int) => s1.toDouble * s2.toDouble)","user":"anonymous","dateUpdated":"2023-03-17T15:40:44+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"productUdf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function2>,DoubleType,Some(List(IntegerType, IntegerType)))\n"}]},"apps":[],"jobName":"paragraph_1679037936184_981099284","id":"20230317-152536_1687317463","dateCreated":"2023-03-17T15:25:36+0800","dateStarted":"2023-03-17T15:40:44+0800","dateFinished":"2023-03-17T15:40:45+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5368"},{"text":"%spark\n// 求同一部电影，不同的两个用户的评分积\nval productDf = joinDf.withColumn(\"rating_product\", productUdf(col(\"rating\"), col(\"rating2\")))\n  .select(\"user_id\", \"user_id2\", \"rating_product\")\nproductDf.show(10)","user":"anonymous","dateUpdated":"2023-03-17T15:40:49+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------+--------------+\n|user_id|user_id2|rating_product|\n+-------+--------+--------------+\n|      1|     610|          20.0|\n|      1|     609|          12.0|\n|      1|     608|           8.0|\n|      1|     607|          16.0|\n|      1|     606|           8.0|\n|      1|     605|          16.0|\n|      1|     604|          12.0|\n|      1|     603|          16.0|\n|      1|     601|          16.0|\n|      1|     600|           8.0|\n+-------+--------+--------------+\nonly showing top 10 rows\n\nproductDf: org.apache.spark.sql.DataFrame = [user_id: int, user_id2: int ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1679038175023_-1916847035","id":"20230317-152935_1515565004","dateCreated":"2023-03-17T15:29:35+0800","dateStarted":"2023-03-17T15:40:49+0800","dateFinished":"2023-03-17T15:40:52+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5369"},{"text":"%spark\n// 求两个用户之间所有共同看过的电影的评分和\nval userGroupDf = productDf.groupBy(\"user_id\", \"user_id2\")\n  .agg(\"rating_product\" -> \"sum\")\n  .withColumnRenamed(\"sum(rating_product)\", \"rating_sum_pro\")\nuserGroupDf.show(10)","user":"anonymous","dateUpdated":"2023-03-17T15:40:56+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------+--------------+\n|user_id|user_id2|rating_sum_pro|\n+-------+--------+--------------+\n|      1|     587|         435.0|\n|      2|     582|         128.0|\n|      4|     599|        1442.0|\n|      7|     475|         583.0|\n|      9|     564|          48.0|\n|     12|     589|          12.0|\n|     16|     584|          71.0|\n|     18|     552|         598.0|\n|     21|     600|         858.0|\n|     26|     594|          99.0|\n+-------+--------+--------------+\nonly showing top 10 rows\n\nuserGroupDf: org.apache.spark.sql.DataFrame = [user_id: int, user_id2: int ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1679038214316_-366692799","id":"20230317-153014_902427085","dateCreated":"2023-03-17T15:30:14+0800","dateStarted":"2023-03-17T15:40:56+0800","dateFinished":"2023-03-17T15:41:02+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5370"},{"text":"%spark\nval userRatingDf = userGroupDf\n  .join(broadcast(userSumDf),userGroupDf(\"user_id\")===userSumDf(\"user_id_sum\"))\n  .drop(\"user_id_sum\")\n  .withColumnRenamed(\"rating_sqrt_sum\",\"rating_sqrt_user_id_sum\")\n  .join(broadcast(userSumDf),userGroupDf(\"user_id2\")===userSumDf(\"user_id_sum\"))\n  .drop(\"user_id_sum\")\n  .withColumnRenamed(\"rating_sqrt_sum\",\"rating_sqrt_user_id2_sum\")\nuserRatingDf.show(10)","user":"anonymous","dateUpdated":"2023-03-17T15:58:01+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------+--------------+-----------------------+------------------------+\n|user_id|user_id2|rating_sum_pro|rating_sqrt_user_id_sum|rating_sqrt_user_id2_sum|\n+-------+--------+--------------+-----------------------+------------------------+\n|      1|     587|         435.0|      67.60917097554147|       52.40229002629561|\n|      2|     582|         128.0|      21.68524844220144|      30.540956108150905|\n|      4|     599|        1442.0|     55.695601262577284|      137.63720427268203|\n|      7|     475|         583.0|      43.04648650006177|       55.24717187331855|\n|      9|     564|          48.0|     23.706539182259394|       45.97281805589037|\n|     12|     589|          12.0|      25.16445906432324|        26.1725046566048|\n|     16|     584|          71.0|      37.26929030716845|      38.742741255621034|\n|     18|     552|         598.0|      84.80713413386871|       45.38997686714546|\n|     21|     600|         858.0|      71.80006963784923|       87.77385715576136|\n|     26|     594|          99.0|       15.0996688705415|        63.2435767489474|\n+-------+--------+--------------+-----------------------+------------------------+\nonly showing top 10 rows\n\nuserRatingDf: org.apache.spark.sql.DataFrame = [user_id: int, user_id2: int ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1679038250009_823995976","id":"20230317-153050_7471448","dateCreated":"2023-03-17T15:30:50+0800","dateStarted":"2023-03-17T15:57:46+0800","dateFinished":"2023-03-17T15:57:53+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5371"},{"text":"%spark\nval simUdf = udf((pro:Double,s1:Double,s2:Double)=>pro/(s1*s2))\nval simDf = userRatingDf.withColumn(\"sim\",simUdf(col(\"rating_sum_pro\"),col(\"rating_sqrt_user_id_sum\"),col(\"rating_sqrt_user_id2_sum\"))).select(\"user_id\",\"user_id2\",\"sim\")\nsimDf.show(10) // 两个用户之间的相似度","user":"anonymous","dateUpdated":"2023-03-17T15:59:25+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------+-------------------+\n|user_id|user_id2|                sim|\n+-------+--------+-------------------+\n|      1|     587|0.12278162583180302|\n|      2|     582|0.19326932892195375|\n|      4|     599|0.18810854366027369|\n|      7|     475|0.24514373228551206|\n|      9|     564|0.04404249903637662|\n|     12|     589|0.01821999951473436|\n|     16|     584|0.04917188754496709|\n|     18|     552|  0.155349133471864|\n|     21|     600| 0.1361436026792233|\n|     26|     594|0.10366958202725449|\n+-------+--------+-------------------+\nonly showing top 10 rows\n\nsimUdf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function3>,DoubleType,Some(List(DoubleType, DoubleType, DoubleType)))\nsimDf: org.apache.spark.sql.DataFrame = [user_id: int, user_id2: int ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1679038867529_387141282","id":"20230317-154107_1262914170","dateCreated":"2023-03-17T15:41:07+0800","dateStarted":"2023-03-17T15:59:25+0800","dateFinished":"2023-03-17T15:59:47+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5372"},{"text":"%spark\n// 获取电影数据\nval movieData = spark.read\n  .option(\"header\", \"true\") //将第一行当作表头\n  .option(\"inferSchema\", \"true\") //推断数据类型\n  .csv(\"hdfs://nameservice1/test/data/movies.csv\")\n movieData.describe().show()\n movieData.createOrReplaceTempView(\"movie\")","user":"anonymous","dateUpdated":"2023-03-17T16:06:52+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------------------+--------------------+------------------+\n|summary|          movie_id|               title|            genres|\n+-------+------------------+--------------------+------------------+\n|  count|              9742|                9742|              9742|\n|   mean|42200.353623485935|                null|              null|\n| stddev| 52160.49485443825|                null|              null|\n|    min|                 1|\"11'09\"\"01 - Sept...|(no genres listed)|\n|    max|            193609|À nous la liberté...|           Western|\n+-------+------------------+--------------------+------------------+\n\nmovieData: org.apache.spark.sql.DataFrame = [movie_id: int, title: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1679039957177_-1634754049","id":"20230317-155917_856282327","dateCreated":"2023-03-17T15:59:17+0800","dateStarted":"2023-03-17T16:06:52+0800","dateFinished":"2023-03-17T16:07:23+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5373"},{"text":"%spark\nval userFilter = simDf.where(\"user_id = 130\").orderBy(desc(\"sim\")).limit(10).select(\"user_id2\",\"sim\")\nuserFilter.show()","user":"anonymous","dateUpdated":"2023-03-17T16:57:27+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+------------------+\n|user_id2|               sim|\n+--------+------------------+\n|     574|0.8000455149950941|\n|     468|0.7768975383047598|\n|     145|0.7348256724964953|\n|     242|0.6743998063840039|\n|     485|0.6376754877320332|\n|     340|0.6368068497610104|\n|     374|0.6014387482761888|\n|     179|0.5963019621412563|\n|     379|0.5862352639952977|\n|     498|0.5729279124783339|\n+--------+------------------+\n\nuserFilter: org.apache.spark.sql.DataFrame = [user_id2: int, sim: double]\n"}]},"apps":[],"jobName":"paragraph_1679042257589_-1170895778","id":"20230317-163737_706949339","dateCreated":"2023-03-17T16:37:37+0800","dateStarted":"2023-03-17T16:44:15+0800","dateFinished":"2023-03-17T16:45:35+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5374"},{"text":"%spark\nval a = data.join(broadcast(userFilter),userFilter(\"user_id2\") === data(\"user_id\")).select(\"movie_id\",\"rating\",\"sim\")\na.show()","user":"anonymous","dateUpdated":"2023-03-17T16:58:59+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+------+------------------+\n|movie_id|rating|               sim|\n+--------+------+------------------+\n|       1|   5.0|0.7348256724964953|\n|      50|   5.0|0.7348256724964953|\n|     111|   4.0|0.7348256724964953|\n|     150|   3.0|0.7348256724964953|\n|     153|   3.0|0.7348256724964953|\n|     161|   4.0|0.7348256724964953|\n|     165|   3.0|0.7348256724964953|\n|     208|   3.0|0.7348256724964953|\n|     231|   3.0|0.7348256724964953|\n|     292|   3.0|0.7348256724964953|\n|     296|   4.0|0.7348256724964953|\n|     300|   3.0|0.7348256724964953|\n|     316|   2.0|0.7348256724964953|\n|     318|   3.0|0.7348256724964953|\n|     329|   3.0|0.7348256724964953|\n|     339|   3.0|0.7348256724964953|\n|     344|   2.0|0.7348256724964953|\n|     380|   3.0|0.7348256724964953|\n|     434|   3.0|0.7348256724964953|\n|     588|   4.0|0.7348256724964953|\n+--------+------+------------------+\nonly showing top 20 rows\n\na: org.apache.spark.sql.DataFrame = [movie_id: int, rating: double ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1679043288037_-807895935","id":"20230317-165448_1314227925","dateCreated":"2023-03-17T16:54:48+0800","dateStarted":"2023-03-17T16:58:59+0800","dateFinished":"2023-03-17T17:00:11+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5375"},{"text":"%spark\na.createOrReplaceTempView(\"a\")\nval movieTop = spark.sql(\n  \"\"\"\n    |SELECT /*+ broadcast(b) */\n    |       a.movie_id\n    |       ,sum(rating*sim)\n    |FROM a\n    |LEFT JOIN\n    |(\n    |\tSELECT  movie_id\n    |\tFROM udata\n    |\tWHERE user_id = 130\n    |)b\n    |ON a.movie_id = b.movie_id\n    |WHERE b.movie_id is null\n    |group by a.movie_id\n    |order by sum(rating*sim) desc\n    |limit 3\n    |\"\"\".stripMargin)\nmovieTop.show()","user":"anonymous","dateUpdated":"2023-03-17T17:01:20+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+-------------------+\n|movie_id|sum((rating * sim))|\n+--------+-------------------+\n|     457| 19.092075207414954|\n|      47|  17.11941167640521|\n|     356| 16.281878674122392|\n+--------+-------------------+\n\nmovieTop: org.apache.spark.sql.DataFrame = [movie_id: int, sum((rating * sim)): double]\n"}]},"apps":[],"jobName":"paragraph_1679040199082_719397352","id":"20230317-160319_337338802","dateCreated":"2023-03-17T16:03:19+0800","dateStarted":"2023-03-17T17:01:20+0800","dateFinished":"2023-03-17T17:03:56+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5376"},{"text":"%spark\nmovieTop.join(movieData,movieData(\"movie_id\") === movieTop(\"movie_id\")).select(\"title\").show(false)","user":"anonymous","dateUpdated":"2023-03-17T17:47:08+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------------------------+\n|title                      |\n+---------------------------+\n|Seven (a.k.a. Se7en) (1995)|\n|Forrest Gump (1994)        |\n|Fugitive, The (1993)       |\n+---------------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1679041187855_441621819","id":"20230317-161947_295490153","dateCreated":"2023-03-17T16:19:47+0800","dateStarted":"2023-03-17T17:47:08+0800","dateFinished":"2023-03-17T17:47:53+0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5377"},{"text":"%spark\n","user":"anonymous","dateUpdated":"2023-03-17T16:36:37+0800","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1679042197405_1782289658","id":"20230317-163637_350752056","dateCreated":"2023-03-17T16:36:37+0800","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:5378"}],"name":"Movie-recommender-userCF","id":"2HWYV2955","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}